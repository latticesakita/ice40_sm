[日本語版はこちら → README.md](README.md)

# iCE40_SM

This project implements a RISC-V processor (SM core) on the Lattice iCE40 Ultra Plus FPGA using Lattice Propel.

---

## 🚀 Overview

This project aims to build a RISC-V based SoC on the low-power, small-footprint **iCE40 Ultra Plus** FPGA. It uses Lattice Propel to integrate hardware design and software development. For reference, it includes an initialization routine for an image sensor.

The iCE40_nano project focused on compactness over performance, while this project improves performance. Although the Fmax is lower than nano, the overall performance is approximately 5 times higher. It consumes about 800 more LUTs than the nano version.

---

## 🔧 Technologies Used

- FPGA: Lattice iCE40 Ultra Plus  
- Development Tools:
  - Lattice Propel (Builder: `ice40_sm.sbx`)
  - Lattice Radiant (Project: `ice40_sm.rdf`)
- Processor: RISC-V  
- HDL: Verilog  
- Accessing iCE40UP hardened IP from RISC-V  
- RISC-V runs on SPSRAM of iCE40UP  
- IP Packaging: `.ipk` using Propel's `ippack`

---

## 📦 Custom IP

This project uses Propel's `ippack` tool to create and package custom IPs.

- IP Directory: `IP/`
- Main IPs:
  - `ahb_spsram_sm`
  - `gpio_ahbl`
  - `timer_ahbl`
  - `uart_ahbl`

---

## 📁 Directory Structure

- iCE40_SM/
  - dpram1024x8/
  - dpram2048x2_512x8/
  - ice40_sm/
    - ice40_common/
    - lib/
      - IPs/
      - latticesemi.com/
      - personal/
  - IP/
    - ahb_spsram_sm/
    - gpio_ahbl/
    - timer_ahbl/
    - uart_ahbl/
  - propel_ws/
  - sge/
  - tb/
  - verification/
  - impl_1/

---

## 🛠️ Build Instructions

Please install Python on your system.  
The mem file generated by Propel is converted to a binary file.

1. Edit C source using Lattice Propel and open `propel_ws`  
2. After build, mem file is automatically copied to `tb/`  
3. Run simulation using `tb/tb.spf` script from Radiant  
4. Launch Propel Builder and open `ice40_sm/ice40_sm.sbx`  
5. If changes are made in Builder, launch Radiant from Builder to reflect them  
6. Write to SPI Flash:
   - Address: 0x000000 → `impl_1/ice40_sm_impl_1.bin`
   - Address: 0x030000 → `propel_ws/ice40_sm/Debug/ice40_sm_Code_BE.bin`
   - Address: 0x050000 → `propel_ws/ice40_sm/Debug/ice40_sm_Data_BE.bin`

Target evaluation board: Upduino board

---

## 📄 License

Please refer to the license specified in each source file.

---

## 🙋‍♂️ Contribution

Issues and Pull Requests are welcome!
